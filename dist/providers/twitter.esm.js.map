{"version":3,"file":"twitter.esm.js","sources":["../../src/providers/twitter.ts"],"sourcesContent":["import { OAuth2BaseProvider } from \"./oauth2.base\";\r\nconst defaultConfig = {\r\n    id: \"twitter\",\r\n};\r\nexport class TwitterAuthProvider extends OAuth2BaseProvider {\r\n    constructor(config) {\r\n        super({\r\n            ...defaultConfig,\r\n            ...config,\r\n        });\r\n    }\r\n    async getRequestToken(auth, host) {\r\n        const endpoint = \"https://api.twitter.com/oauth/request_token\";\r\n        const data = {\r\n            oauth_callback: encodeURIComponent(this.getCallbackUri(auth, host)),\r\n            oauth_consumer_key: this.config.apiKey,\r\n        };\r\n        const res = await fetch(`${endpoint}?${new URLSearchParams(data)}`, { method: \"POST\" });\r\n        const { oauth_token, oauth_token_secret, oauth_callback_confirmed } = await res.json();\r\n        return {\r\n            oauthToken: oauth_token,\r\n            oauthTokenSecret: oauth_token_secret,\r\n            oauthCallbackConfirmed: oauth_callback_confirmed,\r\n        };\r\n    }\r\n    async getAuthorizationUrl({ url }, auth, state, nonce) {\r\n        const endpoint = \"https://api.twitter.com/oauth/authorize\";\r\n        const { oauthToken } = await this.getRequestToken(auth, url.host);\r\n        const data = {\r\n            oauth_token: oauthToken,\r\n        };\r\n        const authUrl = `${endpoint}?${new URLSearchParams(data)}`;\r\n        return authUrl;\r\n    }\r\n    async getTokens(oauthToken, oauthVerifier) {\r\n        const endpoint = \"https://api.twitter.com/oauth/access_token\";\r\n        const data = {\r\n            oauth_consumer_key: this.config.apiKey,\r\n            oauth_token: oauthToken,\r\n            oauth_verifier: oauthVerifier,\r\n        };\r\n        const res = await fetch(`${endpoint}?${new URLSearchParams(data)}`, { method: \"POST\" });\r\n        return await res.json();\r\n    }\r\n    async getUserProfile({ oauth_token, oauth_token_secret: _ }) {\r\n        const endpoint = \"https://api.twitter.com/1.1/account/verify_credentials.json\";\r\n        const res = await fetch(endpoint, { headers: { Authorization: `Bearer ${oauth_token}` } });\r\n        return await res.json();\r\n    }\r\n    async callback(event, auth) {\r\n        const { url } = event;\r\n        const oauthToken = url.searchParams.get(\"oauth_token\");\r\n        const oauthVerifier = url.searchParams.get(\"oauth_verifier\");\r\n        const redirect = this.getStateValue(url.searchParams, \"redirect\");\r\n        const tokens = await this.getTokens(oauthToken, oauthVerifier);\r\n        let user = await this.getUserProfile(tokens);\r\n        if (this.config.profile) {\r\n            user = await this.config.profile(user, tokens);\r\n        }\r\n        return [user, redirect ?? this.getUri(auth, \"/\", url.host)];\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;AACA,MAAM,gBAAgB;AAAA,EAClB,IAAI;AAAA;kCAEiC,mBAAmB;AAAA,EACxD,YAAY,QAAQ;AAChB,UAAM;AAAA,SACC;AAAA,SACA;AAAA;AAAA;AAAA,QAGL,gBAAgB,MAAM,MAAM;AAC9B,UAAM,WAAW;AACjB,UAAM,OAAO;AAAA,MACT,gBAAgB,mBAAmB,KAAK,eAAe,MAAM;AAAA,MAC7D,oBAAoB,KAAK,OAAO;AAAA;AAEpC,UAAM,MAAM,MAAM,MAAM,GAAG,YAAY,IAAI,gBAAgB,SAAS,EAAE,QAAQ;AAC9E,UAAM,EAAE,aAAa,oBAAoB,6BAA6B,MAAM,IAAI;AAChF,WAAO;AAAA,MACH,YAAY;AAAA,MACZ,kBAAkB;AAAA,MAClB,wBAAwB;AAAA;AAAA;AAAA,QAG1B,oBAAoB,EAAE,OAAO,MAAM,OAAO,OAAO;AACnD,UAAM,WAAW;AACjB,UAAM,EAAE,eAAe,MAAM,KAAK,gBAAgB,MAAM,IAAI;AAC5D,UAAM,OAAO;AAAA,MACT,aAAa;AAAA;AAEjB,UAAM,UAAU,GAAG,YAAY,IAAI,gBAAgB;AACnD,WAAO;AAAA;AAAA,QAEL,UAAU,YAAY,eAAe;AACvC,UAAM,WAAW;AACjB,UAAM,OAAO;AAAA,MACT,oBAAoB,KAAK,OAAO;AAAA,MAChC,aAAa;AAAA,MACb,gBAAgB;AAAA;AAEpB,UAAM,MAAM,MAAM,MAAM,GAAG,YAAY,IAAI,gBAAgB,SAAS,EAAE,QAAQ;AAC9E,WAAO,MAAM,IAAI;AAAA;AAAA,QAEf,eAAe,EAAE,aAAa,oBAAoB,KAAK;AACzD,UAAM,WAAW;AACjB,UAAM,MAAM,MAAM,MAAM,UAAU,EAAE,SAAS,EAAE,eAAe,UAAU;AACxE,WAAO,MAAM,IAAI;AAAA;AAAA,QAEf,SAAS,OAAO,MAAM;AACxB,UAAM,EAAE,QAAQ;AAChB,UAAM,aAAa,IAAI,aAAa,IAAI;AACxC,UAAM,gBAAgB,IAAI,aAAa,IAAI;AAC3C,UAAM,WAAW,KAAK,cAAc,IAAI,cAAc;AACtD,UAAM,SAAS,MAAM,KAAK,UAAU,YAAY;AAChD,QAAI,OAAO,MAAM,KAAK,eAAe;AACrC,QAAI,KAAK,OAAO,SAAS;AACrB,aAAO,MAAM,KAAK,OAAO,QAAQ,MAAM;AAAA;AAE3C,WAAO,CAAC,MAAM,YAAY,KAAK,OAAO,MAAM,KAAK,IAAI;AAAA;AAAA;;;;"}